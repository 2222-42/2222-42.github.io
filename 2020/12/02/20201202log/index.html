<!doctype html><html lang=jp><head><meta charset=utf-8><title>20201202log</title><meta name=description content="2222-42's weblog"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://2222-42.github.io/index.xml title="Que Lock Si Jeus Nee"><link id=dark-mode-theme rel=stylesheet href=https://2222-42.github.io/css/dark.css><link rel=stylesheet href=https://2222-42.github.io/fontawesome/css/all.min.css><script src=https://2222-42.github.io/js/bundle.js></script><script src=https://2222-42.github.io/js/instantpage.js type=module defer></script><meta name=generator content="Hugo 0.74.3"><meta property="og:title" content="20201202log"><meta property="og:description" content="今日は皮膚科に行ったり"><meta property="og:type" content="article"><meta property="og:url" content="https://2222-42.github.io/2020/12/02/20201202log/"><meta property="og:image" content="https://2222-42.github.io/myIcon.jpg"><meta property="article:published_time" content="2020-12-02T12:07:44+00:00"><meta property="article:modified_time" content="2020-12-02T12:07:44+00:00"><meta property="og:site_name" content="Que Lock Si Jeus Nee"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://2222-42.github.io/myIcon.jpg"><meta name=twitter:title content="20201202log"><meta name=twitter:description content="今日は皮膚科に行ったり"></head><body><header><nav class=navbar><div class=nav><a href=https://2222-42.github.io/ class=nav-logo><img src=https://2222-42.github.io/images/myIcon.jpg width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/about/ name=About><i class="fas fa-user fa-lg"></i></a></li><li><a href=/tags/ name=Tags><i class="fas fa-tag fa-lg"></i></a></li><li><a href=/search/ name=Search><i class="fas fa-search fa-lg"></i></a></li></ul></div></nav><div class=intro-header><div class=container><div class=post-heading><h1>20201202log</h1><span class=meta-post><i class="fa fa-calendar-alt"></i>&nbsp;Dec 2, 2020</span></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>今日は皮膚科に行ったり</p><h1 id=diary>diary</h1><h2 id=game>game</h2><p>昨晩はゴッドフィールドをプレイしていた。ルールを大凡把握できた。</p><p>APEXをインストールした。チュートリアルを終えた。</p><h2 id=dermatology>dermatology</h2><p>午前中に皮膚科に行った。</p><p>ステロイド治療をすることになった。かなり即効性がある。</p><h2 id=long-nap>long nap</h2><p>五時間昼寝していた。</p><h2 id=mercari>mercari</h2><p>ウェブポンでダブった製品をメルカリに出品。</p><p>そのコラボ相手の人気はそれほど高くないので、売れる見込みは少ないが、
市場価値としてこうあってほしい金額で出しておく。</p><p>ウェブポンの場合、転売という表現はあまり該当しない。ああいった謎の景品の場合、こうでもしないと価値が定まらない。</p><p>あと、反応を見ていると、コラボ相手のファン層がメルカリとか転売とかにすごく嫌な感情を抱き、それが先行し過ぎている人がちらほら見えた。
それはその層特有ではなく、広くそういうものなのかもしれない。
(ファン心理として認められないものを売ることがあるのは確か。例えばサイン色紙とか。)</p><p>そういった反応を頭が悪いというつもりはないし、転売は良い行為だと両手を上げるわけでもない。
ただ、市場に出回る機会すらないようなコラボ商品という物の価値はとてつもなく低いか、とてつもなく高いかで、つまり値段が付けられないものであり、結局、そのコラボ相手の価値を測れないものであることを示してしまう。</p><h1 id=今日の勉強>今日の勉強</h1><h2 id=rust>rust</h2><p><em>TRPL</em> pp.216-225</p><p>関数のライフタイム注釈の書き方</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>function_name</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> (x: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> t, y: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> t) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> t {
    ...
}
</code></pre></div><p>コンパイラに型注釈が教えること:</p><ul><li>何らかのライフタイム<code>'a</code>に対して<ul><li>その引数は少なくともライフタイム<code>'a</code>と同じだけ生きること</li><li>その返り値もまた少なくともライフタイム<code>'a</code>と同じだけ生きること<ul><li>引数のうち小さいほうに等しい具体的なライフタイムになる</li></ul></li></ul></li></ul><p>いかなる値のライフタイムも変更していない。
むしろ借用チェッカーはこれらの制約を守らない値をすべて拒否するべきと指定。
引数のうち小さいほうに等しい具体的なライフタイムになるので、無効になる可能性があるので、その場合は拒否する。</p><p>関数は正確な生存期間を知る必要はなく、何らかのスコープが<code>'a</code>に代替され、このシグニチャを満足することだけを知っている必要がある。</p><p>手動でライフタイム注釈をする必要がある理由</p><ul><li><p>注釈は関数シグニチャに嵌り、関数本体には嵌らない</p></li><li><p>コンパイラは、</p><ul><li>関数内のコードを解析できる一方で、</li><li>外から持ち込まれた参照や外へ持ち出される参照がある場合、それだけの情報でライフタイムを解決することはほぼ不可能<ul><li>例外としてライフタイム省略規則があり、解決できる</li></ul></li></ul></li><li><p>ライフタイム引数を指定する必要のある手段は関数が行っていることによる</p></li><li><p>関数が参照を返す際、戻り値のライフタイム引数は、引数のうち、どれかのライフタイム引数と一致する必要がある</p><ul><li>そうでなければ、関数内で生成された値への参照であり、それは末端のスコープで抜け、片づけられ、タングリング参照をうむ<ul><li>その場合は所有されたデータ型を返せ</li></ul></li></ul></li><li><p>究極的にライフタイム記法は、関数の色々な引数と戻り値のライフタイムと接続することに関する</p><ul><li>繋がりができたら<ul><li>メモリ安全な処理を許可するのに十分な情報がコンパイラにはあり</li><li>メモリ安全性を損なうタングリングポインタを生成するであろう処理を不認可する</li></ul></li></ul></li></ul><h3 id=構造体にライフタイム>構造体にライフタイム</h3><p>構造体に参照を保持させるには、ライフタイム注釈をつける必要がある</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>StructName</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> {
    field: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> t
}
</code></pre></div><p>この注釈は、StructNameのインスタンスがフィールドに保持している参照よりも長生きしないことを意味する。</p><h3 id=ライフタイム省略規則>ライフタイム省略規則</h3><p>ライフタイム注釈なしでコンパイルできるケースは歴史的な経緯による</p><ul><li>開発者が予測可能で決定的なパターンをコンパイラのコードに落とし込んで</li><li>借用チェッカーがライフタイムを推論できるようになり、明示的な注釈を必要としなくなった。</li></ul><p>ライフタイム省略規則:</p><ul><li>コンパイラの参照解析に落とし込まれたパターンのこと<ul><li>コンパイラが考慮する一連の特定のケース</li></ul></li><li>完全な推論を提供しない<ul><li>曖昧性があるなら推論するのではなくエラーを与える</li></ul></li></ul><p>用語:</p><ul><li>引数のライフタイムを「入力ライフタイム」といい</li><li>戻り値のライフタイムを「出力ライフタイム」という</li></ul><p>３つの規則。上から順に適用される。</p><ol><li>参照である各引数は、独自のライフタイム引数を得る</li><li>1つだけ入力ライフタイム引数があるなら、そのライフタイムを全ての出力ライフタイム引数に代入する</li><li>複数の入力ライフタイム引数があるが、メソッドなのでそのうち一つが<code>& self</code> や<code>&mut self</code>なので、<code>self</code>のライフタイムが全出力ライフタイム引数に代入される</li></ol><h3 id=メソッドシグニチャのライフタイム引数>メソッドシグニチャのライフタイム引数</h3><p>ジェネリックな型引数の場合と同じ記法</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#66d9ef>impl</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> StructName <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> {
    ...
}
</code></pre></div><ul><li>参照が構造体のフィールドの参照のライフタイムに紐づくか独立しているかの可能性があること</li><li>省略規則でライフタイム注釈が必要なくなることがよくあること</li></ul><h3 id=static>&lsquo;static</h3><ul><li>特殊なライフタイム <code>'static</code>は、プログラム全体の期間を指す。<ul><li>例えば、文字列リテラルは全てこれ<ul><li>なぜなら、プログラムのバイナリに直接格納され、常に利用可能だから。</li></ul></li></ul></li></ul><p>注意: エラーメッセージで<code>'static</code>ライフタイムの仕様を提言されても、本当に全期間生きてほしいかどうかを考慮せよ</p><p>なぜならほとんどの場合、その問題は以下のいずれかである。</p><ul><li>タングリング参照を生成しているか</li><li>利用可能なライフタイムが不一致しているか</li></ul><div class=blog-tags><a href=https://2222-42.github.io//tags/health/>health</a>&nbsp;
<a href=https://2222-42.github.io//tags/rust/>rust</a>&nbsp;
<a href=https://2222-42.github.io//tags/game/>game</a>&nbsp;
<a href=https://2222-42.github.io//tags/economy/>economy</a>&nbsp;</div></article></div><footer><div><a href=https://twitter.com/9_6_42 name=twitter><em class="fab fa-twitter"></em></a><a href=https://github.com/2222-42 name=github><em class="fab fa-github"></em></a></div><div class=container><p class="credits copyright"><a href=https://2222-42.github.io/about>2222-42</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://2222-42.github.io/>Que Lock Si Jeus Nee</a>
&nbsp;&ndash;&nbsp;
<i class="fas fa-moon" id=dark-mode-toggle></i><p class="credits theme-by"><a href=https://gohugo.io>Hugo</a>&nbsp;
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></p></div></footer></body></html>